<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ E-commerce API</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .endpoint { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .method { font-weight: bold; color: #0066cc; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { background: #e8f5e8; padding: 10px; margin: 10px 0; border-radius: 3px; white-space: pre-wrap; }
        .error { background: #ffeaea; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; border: 1px solid #b8daff; }
    </style>
</head>
<body>
    <h1>üõí E-commerce –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</h1>
    
    <h2>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:</h2>
    <div class="endpoint">
        <strong>API Gateway:</strong> http://localhost:8080 ‚úÖ<br>
        <strong>RabbitMQ Management:</strong> <a href="http://localhost:15672" target="_blank">http://localhost:15672</a> ‚úÖ<br>
        <strong>SQL Server:</strong> localhost:1433 ‚úÖ
    </div>

    <h2>üí≥ Payments Service</h2>
    
    <div class="endpoint">
        <span class="method">POST</span> /api/payments/accounts
        <br>–°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞:
        <br><input type="text" id="create-user-id" placeholder="User ID" value="11111111-1111-1111-1111-111111111111" style="width: 300px;">
        <button onclick="generateUserId()">–ù–æ–≤—ã–π User ID</button>
        <br><button onclick="createAccount()" style="margin-top: 10px;">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
        <div id="account-result" class="result" style="display:none;"></div>
    </div>

    <div class="endpoint">
        <span class="method">POST</span> /api/payments/accounts/{id}/top-up
        <br>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ (Account ID = User ID):
        <br><input type="text" id="account-id" placeholder="User ID (= Account ID)" style="width: 300px;">
        <input type="number" id="amount" placeholder="–°—É–º–º–∞" value="1000" style="width: 100px;">
        <button onclick="topUpAccount()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
        <div id="topup-result" class="result" style="display:none;"></div>
    </div>

    <div class="endpoint">
        <span class="method">GET</span> /api/payments/accounts/{id}/balance
        <br>–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ (—Ç–µ–ø–µ—Ä—å Account ID = User ID):
        <br><input type="text" id="balance-account-id" placeholder="User ID (= Account ID)" style="width: 300px;">
        <button onclick="checkBalance()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
        <div id="balance-result" class="result" style="display:none;"></div>
    </div>

    <h2>üì¶ Orders Service</h2>
    
    <div class="endpoint">
        <span class="method">POST</span> /api/orders
        <br>–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞:
        <br><input type="text" id="user-id" placeholder="User ID" value="11111111-1111-1111-1111-111111111111" style="width: 300px;">
        <input type="number" id="order-amount" placeholder="–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞" value="299.99" style="width: 100px;">
        <button onclick="createOrder()">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
        <div id="order-result" class="result" style="display:none;"></div>
    </div>

    <div class="endpoint">
        <span class="method">GET</span> /api/orders?userId={id}
        <br>–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤:
        <br><input type="text" id="orders-user-id" placeholder="User ID" value="11111111-1111-1111-1111-111111111111" style="width: 300px;">
        <button onclick="getOrders()">–ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã</button>
        <div id="orders-result" class="result" style="display:none;"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';

        async function apiCall(method, endpoint, body = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                if (body) {
                    options.body = JSON.stringify(body);
                }
                
                const response = await fetch(API_BASE + endpoint, options);
                let data = null;
                const contentType = response.headers.get('content-type');
                
                if (contentType && contentType.includes('application/json')) {
                    const text = await response.text();
                    if (text) {
                        data = JSON.parse(text);
                    }
                }
                
                return {
                    status: response.status,
                    statusText: response.statusText,
                    data: data
                };
            } catch (error) {
                return {
                    status: 0,
                    error: error.message
                };
            }
        }

        function showResult(elementId, result) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            
            if (result.error) {
                element.className = 'result error';
                element.textContent = `–û—à–∏–±–∫–∞: ${result.error}`;
            } else if (result.status === 409) {
                element.className = 'result warning';
                element.textContent = `–ê–∫–∫–∞—É–Ω—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (409 Conflict)\n–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤.\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π User ID –∏–ª–∏ —Ä–∞–±–æ—Ç–∞–π—Ç–µ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º.`;
            } else if (result.status >= 400) {
                element.className = 'result error';
                element.textContent = `–û—à–∏–±–∫–∞ ${result.status}: ${result.statusText}`;
            } else {
                element.className = 'result';
                element.textContent = `Status: ${result.status} ${result.statusText}\n${result.data ? JSON.stringify(result.data, null, 2) : '–£—Å–ø–µ—à–Ω–æ'}`;
            }
        }

        function generateUserId() {
            const newUserId = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
            document.getElementById('create-user-id').value = newUserId;
            document.getElementById('user-id').value = newUserId;
            document.getElementById('orders-user-id').value = newUserId;
            document.getElementById('account-id').value = newUserId;
            document.getElementById('balance-account-id').value = newUserId;
        }

        async function createAccount() {
            const userId = document.getElementById('create-user-id').value;
            if (!userId) {
                alert('–í–≤–µ–¥–∏—Ç–µ User ID');
                return;
            }
            const result = await apiCall('POST', '/api/payments/accounts', { userId });
            showResult('account-result', result);
            if (result.status === 201) {
                const currentUserId = document.getElementById('create-user-id').value;
                document.getElementById('account-id').value = currentUserId;
                document.getElementById('balance-account-id').value = currentUserId;
                document.getElementById('user-id').value = currentUserId;
                document.getElementById('orders-user-id').value = currentUserId;
            }
        }

        async function topUpAccount() {
            const accountId = document.getElementById('account-id').value;
            const amount = parseFloat(document.getElementById('amount').value);
            if (!accountId) {
                alert('–í–≤–µ–¥–∏—Ç–µ Account ID');
                return;
            }
            const result = await apiCall('POST', `/api/payments/accounts/${accountId}/top-up`, { amount });
            showResult('topup-result', result);
        }

        async function checkBalance() {
            const accountId = document.getElementById('balance-account-id').value;
            if (!accountId) {
                alert('–í–≤–µ–¥–∏—Ç–µ Account ID');
                return;
            }
            const result = await apiCall('GET', `/api/payments/accounts/${accountId}/balance`);
            showResult('balance-result', result);
        }

        async function createOrder() {
            const userId = document.getElementById('user-id').value;
            const amount = parseFloat(document.getElementById('order-amount').value);
            if (!userId) {
                alert('–í–≤–µ–¥–∏—Ç–µ User ID');
                return;
            }
            const result = await apiCall('POST', '/api/orders', { userId, amount });
            showResult('order-result', result);
        }

        async function getOrders() {
            const userId = document.getElementById('orders-user-id').value;
            if (!userId) {
                alert('–í–≤–µ–¥–∏—Ç–µ User ID');
                return;
            }
            const result = await apiCall('GET', `/api/orders?userId=${userId}`);
            showResult('orders-result', result);
        }
    </script>
</body>
</html> 