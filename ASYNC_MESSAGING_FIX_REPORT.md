# üîß –†–ï–®–ï–ù–ê –ü–†–û–ë–õ–ï–ú–ê: –ê–°–ò–ù–•–†–û–ù–ù–û–ï –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï –ú–ï–ñ–î–£ –ú–ò–ö–†–û–°–ï–†–í–ò–°–ê–ú–ò

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê

**–°–∏–º–ø—Ç–æ–º**: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –Ω–∞ 299 —Ä—É–±–ª–µ–π –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —Å–ø–∏—Å—ã–≤–∞–ª—Å—è.

**–ü—Ä–∏—á–∏–Ω–∞**: –û—à–∏–±–∫–∞ `ObjectDisposedException: Cannot access a disposed context instance` –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π RabbitMQ. 

**–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã**:
- –°–æ–æ–±—â–µ–Ω–∏—è `OrderCreated` —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –∏–∑ Orders Service –≤ RabbitMQ —á–µ—Ä–µ–∑ OutboxProcessor
- Payments Service –ø–æ–ª—É—á–∞–ª —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–æ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ —É—Ç–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ DbContext
- –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∂–∏–∑–Ω–µ–Ω–Ω–æ–º —Ü–∏–∫–ª–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```csharp
Task.Run(async () =>
{
    using var scope = app.Services.CreateScope();
    var messageBus = scope.ServiceProvider.GetRequiredService<IMessageBus>();
    var orderHandler = scope.ServiceProvider.GetRequiredService<OrderCreatedHandler>();
    
    await messageBus.SubscribeAsync<OrderCreated>(orderHandler.HandleOrderCreated);
});
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```csharp
Task.Run(async () =>
{
    await Task.Delay(3000); // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã
    
    using var scope = app.Services.CreateScope();
    var messageBus = scope.ServiceProvider.GetRequiredService<IMessageBus>();
    
    await messageBus.SubscribeAsync<OrderCreated>(async (message) =>
    {
        using var handlerScope = app.Services.CreateScope();
        var orderHandler = handlerScope.ServiceProvider.GetRequiredService<OrderCreatedHandler>();
        await orderHandler.HandleOrderCreated(message);
    });
});
```

### 2. –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

- **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ scope –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è**: –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–µ–∂–∏–π DbContext
- **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤**: Scope –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**: –î–æ–±–∞–≤–ª–µ–Ω–∞ 3-—Å–µ–∫—É–Ω–¥–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã

### 3. –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `src/Services/Payments/Payments.Api/Program.cs`
- `src/Services/Orders/Orders.Api/Program.cs`

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥**: http://localhost:3000
2. **–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç** –∏ **–ø–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å** –Ω–∞ 1000 —Ä—É–±–ª–µ–π
3. **–°–æ–∑–¥–∞–π—Ç–µ –∑–∞–∫–∞–∑** –Ω–∞ 299 —Ä—É–±–ª–µ–π
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å** - –æ–Ω –¥–æ–ª–∂–µ–Ω —É–º–µ–Ω—å—à–∏—Ç—å—Å—è –Ω–∞ 299 —Ä—É–±–ª–µ–π

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ø–µ—à–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ Orders Service
docker-compose logs orders-api | grep -i "outbox.*processed successfully"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ø–µ—à–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ Payments Service  
docker-compose logs payments-api | grep -i "payment processed successfully"
```

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞**:
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- DbContext —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏ —É—Ç–∏–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ë–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤
- –°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç exactly-once –æ–±—Ä–∞–±–æ—Ç–∫—É —á–µ—Ä–µ–∑ Inbox/Outbox pattern

‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**:
- –î–æ–±–∞–≤–ª–µ–Ω—ã OutboxProcessor –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å CORS –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- –°–æ–∑–¥–∞–Ω —É–¥–æ–±–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üåê –î–û–°–¢–£–ü–ù–´–ï –°–ï–†–í–ò–°–´

- **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: http://localhost:3000
- **API Gateway**: http://localhost:8080
- **RabbitMQ Management**: http://localhost:15672 (guest/guest)
- **SQL Server**: localhost:1433 (sa/YourStrong@Passw0rd)

---

## üöÄ –ö–û–ú–ê–ù–î–´ –ó–ê–ü–£–°–ö–ê

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
docker-compose down

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—é —Å–∏—Å—Ç–µ–º—É
docker-compose up --build -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f
``` 